name: ğŸ” CI - Quality Checks

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  quality-checks:
    name: ğŸ§ª Quality Checks
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ” HTML Validation
      uses: Cyb3r-Jak3/html5validator-action@v7.2.0
      with:
        root: ./
        css: true
        
    - name: ğŸ“Š File Analysis
      run: |
        echo "ğŸ“ Structure du projet:"
        find . -type f -name "*.html" -o -name "*.css" -o -name "*.js" -o -name "*.md" | head -20
        
        echo ""
        echo "ğŸ“ˆ Statistiques:"
        echo "HTML files: $(find . -name "*.html" | wc -l)"
        echo "CSS lines: $(grep -c . *.html | grep -o '[0-9]*' | head -1)"
        echo "JS functions: $(grep -c 'function' *.html)"
        
        echo ""
        echo "ğŸ¯ CompÃ©tences dans le CSV:"
        if [ -f "calc.csv" ]; then
          echo "Total: $(tail -n +2 calc.csv | wc -l) compÃ©tences"
          echo "Domaines: $(tail -n +2 calc.csv | cut -d',' -f2 | sort | uniq | wc -l)"
        fi

    - name: ğŸ”’ Security Check
      run: |
        echo "ğŸ” VÃ©rification de sÃ©curitÃ© basique..."
        
        # VÃ©rifier qu'il n'y a pas de secrets exposÃ©s
        if grep -r "password\|secret\|key\|token" --include="*.html" --include="*.js" .; then
          echo "âš ï¸ Attention: Possibles secrets dÃ©tectÃ©s"
          exit 1
        else
          echo "âœ… Aucun secret dÃ©tectÃ©"
        fi
        
        # VÃ©rifier les bonnes pratiques HTML
        if grep -q "<!DOCTYPE html>" *.html; then
          echo "âœ… DOCTYPE HTML5 prÃ©sent"
        else
          echo "âš ï¸ DOCTYPE HTML5 manquant"
        fi

    - name: ğŸ“± Responsive Check
      run: |
        echo "ğŸ“± VÃ©rification du responsive design..."
        
        if grep -q "@media" *.html; then
          echo "âœ… Media queries dÃ©tectÃ©es"
        else
          echo "âš ï¸ Aucune media query trouvÃ©e"
        fi
        
        if grep -q "viewport" *.html; then
          echo "âœ… Meta viewport prÃ©sent"
        else
          echo "âš ï¸ Meta viewport manquant"
        fi

    - name: â™¿ Accessibility Check
      run: |
        echo "â™¿ VÃ©rification de l'accessibilitÃ©..."
        
        # VÃ©rifier les attributs alt sur les images
        if grep -q 'alt=' *.html; then
          echo "âœ… Attributs alt dÃ©tectÃ©s"
        fi
        
        # VÃ©rifier les labels
        if grep -q 'title=' *.html; then
          echo "âœ… Attributs title prÃ©sents"
        fi
        
        echo "âœ… VÃ©rifications d'accessibilitÃ© terminÃ©es"

    - name: ğŸ¨ Performance Hints
      run: |
        echo "ğŸ¨ Conseils de performance..."
        
        # VÃ©rifier les fonts externes
        font_count=$(grep -c "fonts.googleapis.com" *.html || echo "0")
        echo "ğŸ“ Fonts externes: $font_count"
        
        # VÃ©rifier la taille des fichiers
        html_size=$(wc -c < index.html)
        echo "ğŸ“ Taille index.html: $html_size bytes"
        
        if [ $html_size -gt 100000 ]; then
          echo "âš ï¸ Fichier HTML volumineux (>100KB)"
        else
          echo "âœ… Taille HTML optimale"
        fi